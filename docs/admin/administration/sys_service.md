---
title: 'Обслуживание системы'
---

На форме **Администрирование - Система - Обслуживание** можно выполнить ряд действия для поддержания оптимальной работоспособности системы.
![](img/sys_service1.png)  
Рис. 1 Форма Обслуживание  

- В блоке **Запуск** (рис. 1(1)) доступны функции для остановки сервера, чтобы она не повлияла на работу сотрудников.
  - **Остановить сервер** - кнопка остановки сервера приложений.
  - **Остановка через 5 минут** -  после нажатия кнопки Остановить сервер, он будет остановлен через 5 минут.
  - **Запретить вход новым пользователям** - после нажатия кнопки **Остановить сервер** и до его остановки в систему не смогут входить пользователи, кроме администратора.
  - **Отправить сообщение об остановке сервера** - после нажатия кнопки **Остановить сервер** всем пользователям будет разослано сообщение 
о скорой остановке сервера. Данная функциональность доступна только если подключен модуль "Чат".

- **Очистить прикладные логи** (рис. 1(2) - очищаются все журналы логирования, хранящиеся в БД за время, превышающее установленный срок хранения логов. 
Обычно данное действие настраивается для регулярного выполнения в Планировщике (см. §Задания планировщика). 
Подробно о логировании и его настройках читайте в разделе Журналы.

- В блоках **Однопоточные** и **Многопоточные действия** (рис. 1(3,4) доступны одинаковые действия по обслуживанию БД. 
Для выполнения действия многопоточно надо указать **Количество потоков**. 
Если число не указано, по умолчанию используется количество потоков равное половине количества ядер процессора сервера. 
Регулярные действия по обслуживанию БД настраиваются в **Планировщике**.

  - **Обслуживание БД** - по данной команде выполняются действия по обслуживанию БД (пересчет классов, агрегаций, следствий и ограничений, статистики), 
которые также можно выполнить по отдельности.
  - **Пересчитать классы** - в таблицах БД содержатся классы данных. 
В случае, когда происходит сбой при записи данных в таблицу, и они записываются не полностью, данная команда удаляет такие записи.
  - **Пересчитать агрегации** - в случае, когда вычисляемое свойство (материализация) некорректно записывается в таблицу БД. 
(редкий случай, когда, например, несколько пользователей одновременно изменили не зависящие друг от друга данные, которые влияют на зависящие друг от друга данные), 
данная команда пересчитывает значение по исходным данным и перезаписывает его.
  - **Пересчитать следствия и ограничения** - при возникновении несоответствий в следствиях (например при некорректной агрегации) или 
изменении ограничений и/или следствий (формул, условий и т.д.) и необходимости применить эти изменения ко всей БД используется данная команда. 
Изменения применяются ко всем объектам БД, независимо от времени их создания.
  - **Пересчитать статистику** - рассчитывает количество записей, разновидностей записей и разновидностей ключей в таблицах БД. 
Данные статистики используются платформой для оптимизации запросов, направляемых на выполнение БД. 
Для корректной работы системы необходимо, чтобы доступные платформе статистические данные отличались от действительных значений не более, чем в 5 раз. 
По мере роста БД и количества записей в таблицах необходимость в пересчете статистики возникает реже, 
т.к. требуется больше времени для достижения 5-кратной разницы между текущей и посчитанной статистикой.
  - **Дорасчитать статистику** - когда в таблицы БД добавляются новые колонки, данная команда пересчитывает статистику только по тем таблицам, 
где появились новые колонки.
  - **Проверить классы/агрегации/индексы** - система проверяет по всем таблицам БД наличие некорректных записей 
по классам/ агрегациям / все ли необходимые индексы есть в БД

- Блок **База данных** (рис. 1(5)):
  - **Упаковать таблицы** - команда удаляет строки таблиц БД с пустыми значениями всех ключей. Обычно запускается после команды **Очистить прикладные логи**.
  - **Анализ БД** - вызывает стандартные средства СУБД по анализу базы (для Postgresql [ANALYZE](https://postgrespro.ru/docs/postgresql/14/sql-analyze))).
  - **Упаковать БД** - вызывает стандартные средства СУБД по очистке базы (для Postgresql [VACUUM](https://postgrespro.ru/docs/postgresql/14/sql-vacuum))).
  - **Выключен SERIALIZABLE/REUPDATE** - повышает производительность за счет понижения уровня сериализация. 
При включении повышается риск ошибок агрегаций. Применяется для небольших БД, в которых не используются вычисляемые свойства.
  - **Перерасчет одной транзакцией** - все действия по обслуживанию БД (пересчет классов, агрегаций и т.д.) выполняются в рамках одной транзакции 
и результат записывается по завершении этой транзакции.
  - **Очистить БД потаблично** - вызывает стандартные средства по очистке БД для каждой таблицы, начиная с таблиц с наименьшим количеством записей и далее по возрастанию. 
Позволяет использовать меньше памяти и не обрабатывать отдельные таблицы, 
которые отмечены на форме **Администрирование - Метаданные - Таблицы** (см. § [Действия с отдельными таблицами](#действия-с-отдельными-таблицами))

- **Блок Виртуальная машина** (рис. 1(6)) содержит команды для обслуживания сервера приложений, который работает на Java и имеет свои особенности работы.
  - **Запустить сборщик мусора** - команда запускает полную сборку мусора с дефрагментацией. При этом останавливается выполнение всех действий пользователей.
  - **Данные виртуальной машины** - отображает количество процессоров на сервере и данные по размеру свободной, общей и максимальной памяти, выделенной для Heap
  - **Очистка LRU** - запускает очистку динамического кэша. Можно устанавливать **Процент очистки LRU**, не рекомендуется очистка на 100%, 
или установить **Случайная очистка LRU**.
  - **Сделать Heap Dump** - формируется и сохраняется побайтовая копия памяти Heap. при копировании памяти происходит полная остановка процессов, как и при сборке мусора. 


## Действия с отдельными таблицами

Ряд действий по обслуживанию БД может быть выполнен на отдельных таблицах и даже для отдельных колонок на форме **Администрирование - Метаданные - Таблицы**.

По отдельным таблицам (рис. 2 (1)) можно провести проверку и пересчет классов, пересчет агрегаций колонок (всех), пересчет статистики, упаковка таблицы. 
Для этого необходимо использовать соответствующие кнопки в строке таблицы (рис. 2 (2)). 
Также определенные таблицы можно исключить из обработки при выполнении действий по обслуживанию всей БД. 

Для этого необходимо для таблицы отметить соответствующее свойство: 
- **Отключить пересчет и проверку классов**
- **Отключить пересчет и проверку статистики**
- **Не пересчитывать статистику таблицы**
- **Не очищать**.

Также определенные действия можно выполнять или отключать для колонок таблицы (рис. 2(3), 
также используя кнопки или отмечая свойства для каждой колонки (рис. 2(4): 
- **Проверить/Пересчитать агрегации**
- **Пересчитать агрегации и зависимости/зависимые**
- **Отключить пересчет и проверку агрегаций/статистики**. 

![](img/sys_service2.png)  
Рис. 2 Таблицы БД  

